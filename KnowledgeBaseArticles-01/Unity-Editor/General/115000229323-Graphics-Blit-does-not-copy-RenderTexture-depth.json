[{"title":"Graphics.Blit does not copy RenderTexture depth","authorName":"Ryan Parkinson-Faulkner.","createdDate":"2017-01-06T16:43:21Z","updatedDate":"2017-05-10T13:24:39Z","labels":["Shaders","Graphics","Depth","RenderTexture","Depth Texture","Texture","Render","Blit","Graphics.Blit"],"sections":[{"title":"Symptoms:","content":["\n<li>I have two RenderTextures with format RenderTexture.Depth, Graphics.Blit is not copying the depth values from one to the other.</li>\n"]},{"title":"Cause:","content":["Graphics.Blit draws a quad with Z-Write off, so the depth will not be copied from one RenderTexture to another."]},{"title":"Resolution:","content":["Create a &quot;DepthBlit&quot; Shader to sample and output the Depth Texture as depth values:","\n<tbody>\n<tr>\n<td><strong>//&#xA0;Fragment function outputs&#xA0;depth&#xA0;from&#xA0;_MyDepthTex&#xA0;to&#xA0;depth&#xA0;buffer</strong><br><strong>half4&#xA0;CopyDepthBufferFragmentShader(v2f&#xA0;i,&#xA0;out&#xA0;float&#xA0;outDepth&#xA0;:&#xA0;SV_Depth)&#xA0;:&#xA0;SV_Target</strong><br><strong>{</strong><br><strong>float&#xA0;depth&#xA0;=&#xA0;SAMPLE_DEPTH_TEXTURE(_MyDepthTex,&#xA0;i.uv);</strong><br><strong>outDepth&#xA0;=&#xA0;depth;</strong><br><strong><code> return&#xA0;0;<br>}</code></strong></td>\n</tr>\n</tbody>\n","The complete Shader is also in this article as an attachment. Note: the GPU needs to support GL_FragDepth extension in order to output the depth, most GPUs&#xA0;do, but some older mobiles might not.","Then in C# create a Material and do the Blit using it:","\n<tbody>\n<tr>\n<td><strong>//&#xA0;Create&#xA0;a&#xA0;Material&#xA0;that&#xA0;uses&#xA0;the&#xA0;DepthCopy&#xA0;Shader</strong><br><strong>Material&#xA0;m_DepthCopyMat&#xA0;=&#xA0;new&#xA0;Material(m_DepthCopyShader);</strong><br> <br><strong>//&#xA0;Set&#xA0;the&#xA0;_MyDepthTex&#xA0;Shader&#xA0;Texture&#xA0;to&#xA0;our&#xA0;source&#xA0;depth&#xA0;texture&#xA0;to&#xA0;be&#xA0;copied</strong><br><strong>m_DepthCopyMat.SetTexture(&quot;_MyDepthTex&quot;,&#xA0;m_SrcDepthTexture);</strong><br> <br><strong>//&#xA0;Do&#xA0;a&#xA0;Blit&#xA0;using&#xA0;the&#xA0;DepthCopy&#xA0;Material/Shader</strong><br><strong>Graphics.Blit(m_SrcDepthTexture,&#xA0;m_DstDepthTexture,&#xA0;m_DepthCopyMat);</strong>&#xA0;</td>\n</tr>\n</tbody>\n"]},{"title":"More Information:","content":["If you do not want to copy the Depth Texture but instead want to have a valid depth buffer that can be shared between the Render Targets then you can use:","\n<tbody>\n<tr>\n<td><strong>Graphics.SetRenderTarget(rendertexture.colorBuffer, depthRT.depthBuffer);</strong></td>\n</tr>\n</tbody>\n","before&#xA0;rendering a fullscreen quad for your blit.","Manual page on how to use depth textures in Unity:&#xA0;<a href=\"https://docs.unity3d.com/Manual/SL-DepthTextures.html\" target=\"_blank\" rel=\"noopener noreferrer\">https://docs.unity3d.com/Manual/SL-DepthTextures.html</a>","Information verified accurate for Unity 5.4.3p4."]}]}]