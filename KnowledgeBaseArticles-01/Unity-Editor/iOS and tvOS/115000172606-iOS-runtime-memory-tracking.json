[{"title":"iOS runtime memory tracking","authorName":"Alejandro Lopez.","createdDate":"2017-01-03T14:50:57Z","updatedDate":"2017-01-13T15:06:30Z","labels":["iOS","memory","plugins"],"sections":[{"title":"Symptoms","content":["\n<li>You need to get the runtime memory reported by iOS.</li>\n<li>Your app crashes after running out of memory.</li>\n<li>You are getting memory warnings.</li>\n"]},{"title":"Resolution","content":["You can get the value for all the memory reserved by the application via scripting and send it back to your managed code.","Using Xcode&#x2019;s <strong>Instruments &gt; Activity Monitor</strong>, you can find the memory reserved by the application in the <strong>Real Memory</strong> column.","<img src=\"/hc/en-us/article_attachments/115000734046/Screenshot.png\" alt=\"\" width=\"698\" height=\"356\">","Use this information to analyze your memory on runtime in all the game&#x2019;s Scenes and on different devices.","You can also implement a native plugin to send this information to your server and analyze the memory from the user&#x2019;s gameplay session.","Follow the steps below to get the memory information to Unity:","1. Create a native plugin with a function that sends the information back to managed C# code. Place this file under <strong>Assets/Plugins/iOS</strong> to be included in the Project.","#include &lt;mach/mach.h&gt;\nextern &quot;C&quot;\n{\n    int Report_memory(void)\n    {\n        struct task_basic_info info;\n        mach_msg_type_number_t size = sizeof(info);\n        kern_return_t kerr = task_info(mach_task_self(),\n                                       TASK_BASIC_INFO,\n                                       (task_info_t)&amp;info,\n                                       &amp;size);\n\n        if( kerr == KERN_SUCCESS )\n        {\n            return (int)info.resident_size/1024/1024;\n        }\n        else\n        {\n            return 0;\n        }\n    }\n}\n","2. Create a MonoBehaviour script that calls the native iOS plugins to get the memory report.","float deviceRealMemory\n[DllImport (&quot;__Internal&quot;)]\nprivate static extern int Report_memory();\nIEnumerator GetMemoryIOS()\n{\n        deviceRealMemory = Report_memory ();\n}\n"]},{"title":"More Information","content":["For more information, see the following documentation:","\n<li><a href=\"https://docs.unity3d.com/Manual/NativePluginInterface.html\">Low-level native plugin interface documentation</a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Profiling.Profiler.html\">Profiler script reference documentation</a></li>\n<li><a href=\"http://stackoverflow.com/questions/787160/programmatically-retrieve-memory-usage-on-iphone\">How to programmatically retrieve memory usage on iPhone</a></li>\n"]}]}]