[{"title":"Split canvas for dynamic objects","authorName":"Alejandro Lopez.","createdDate":"2017-01-16T17:43:44Z","updatedDate":"2017-01-16T17:51:52Z","labels":["UI","FPS","profiling","canvas","dynamic objects"],"sections":[{"title":"Symptoms","content":["\n<li>You experience low FPS when using the Unity UI system.</li>\n<li>You see repeated logs of Canvas.BuildBatch in the Profiler.</li>\n<li>You need to optimize the UI.</li>\n"]},{"title":"Cause","content":["You have objects in the UI that change the Transform (position, rotation, scale) every frame, which causes a rebuild of the entire UI batch."]},{"title":"Resolution","content":["Separate dynamic objects from static objects.","If you have a large UI hierarchy with one or more objects that move every frame, you should consider separating the dynamic objects to their own dynamic canvas.","When you have objects that change the RectTransform every frame, this causes the canvas to perform a rebuild of the batch. The canvas rebuild process causes CPU spikes.","<img src=\"/hc/en-us/article_attachments/115000940506/Screenshot_1.png\" alt=\"\" width=\"507\" height=\"221\">","<strong>How to check if you are rebuilding the UI</strong>","If you are using Xcode Instruments, look for <strong>UI::Canvas::UpdateBatches</strong> and <strong>Canvas::RenderOverlays</strong> on the call stack when you use the Time Profiler tool.","If you are using Unity Profiler, look for <strong>Canvas.BuildBatch</strong> and <strong>Canvas.RenderOverlays</strong>.","<strong>Non-optimized</strong>","<img src=\"/hc/en-us/article_attachments/115000919343/Screenshot_2.png\" alt=\"\" width=\"722\" height=\"286\">","<strong>Optimized</strong>","<img src=\"/hc/en-us/article_attachments/115000919363/Screenshot_3.png\" alt=\"\" width=\"722\" height=\"287\">","<em>The images above show the canvas performance with a dynamic object in the same canvas and after being isolated in a new canvas.</em>","If you find that Canvas.BuildBatch is called every frame, you have a UI object that moves every frame.","<strong>Example project:</strong>","Take a look at <a href=\"http://files.unity3d.com/alejandro/CanvasDemo.zip\">this example project</a> for more information. You can build for StandAlone and compare the Profiler results using the UI buttons.","Remember that when you split the canvas it will generate a batch for each new canvas, which will increase the draw calls. You need to balance the design between minimizing the cost of canvas rebuild and generating more batches. This means you need to profile this change to check if it improves your performance.","<strong>Note:</strong> Changing the value of a Text object will not perform a canvas rebuild."]},{"title":"More Information","content":["For more information, please consult the following:","\n<li><a href=\"https://unity3d.com/learn/tutorials/topics/best-practices/fundamentals-unity-ui?playlist=30089\">Fundamentals of Unity UI tutorial&#xA0;</a></li>\n<li><a href=\"https://unity3d.com/learn/tutorials/topics/best-practices/fill-rate-canvases-and-input\">Fill-rate, Canvases and input tutorial&#xA0;</a></li>\n"]}]}]