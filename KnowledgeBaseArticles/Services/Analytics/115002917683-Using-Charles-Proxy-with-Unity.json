[{"title":"Using Charles Proxy with Unity","authorName":"Jeff Dillon.","createdDate":"2017-06-13T15:34:22Z","updatedDate":"2017-06-19T16:02:12Z","labels":["Analytics","Debugging"],"sections":[{"title":"Symptoms","content":["\n<li>I don&apos;t see the event data that I would expect to see on my Analytics Dashboard. I want to confirm that my device is sending Analytics events from my Unity game.</li>\n"]},{"title":"Cause","content":["You might see delays in data (or no data at all) appearing on your Unity Analytics Dashboard, and want to confirm that your mobile application is indeed sending events. You also might want to confirm that expected events are firing at the correct location within your game."]},{"title":"Resolution","content":["Charles Proxy is a great utility that allows you to monitor network activity on your mobile device from your PC. When configured correctly, you are able to see individual network requests and responses as they are generated on your mobile device. This can be handy to confirm that your game is sending events over the network to the Unity data center. This article will explain the steps to get Charles Proxy installed and operating successfully and will give you the ability to watch individual network calls from your mobile device as they are being made during your game execution.","The general steps are as follows, details below under More Information.","\n<li>Install and configure Charles Proxy on your PC or Mac</li>\n<li>Configure your Android or iOS mobile device to use your PC as a network proxy</li>\n<li>Launch your game and monitor the network activity in Charles&#xA0;</li>\n"]},{"title":"More Information","content":["Here are the detailed steps to install and configure Charles Proxy","1. Install Charles Proxy on your PC or Mac. You can install it from <a href=\"https://www.charlesproxy.com/download/latest-release/\" target=\"_blank\" rel=\"noopener noreferrer\">here</a>&#xA0;. The 30 day free trial is fully functional, but will only run for 30 minutes at a time.","2. Upon launching, you should see a screen like this. Note the two toolbar buttons, Clear events and Start/Pause recording. Note that the Structure tab is selected which groups the events by URL. The Sequence tab shows all events in chronological order.","<img src=\"/hc/article_attachments/115009779466/Charles1.png\" alt=\"Charles1.png\" width=\"719\" height=\"499\">","3. If you don&apos;t see the Request and Response tabs on the right pane, go to Preferences/Viewers and uncheck the two Combine checkboxes as shown here:","<img src=\"/hc/article_attachments/115009917183/Charles2.png\" alt=\"Charles2.png\" width=\"723\" height=\"497\">","4. To avoid seeing local traffic on the PC/Mac, from the Proxy menu, uncheck Windows Proxy/macOS Proxy.","5. Enable SSL proxying by navigating to the Proxy menu and choosing SSL Proxying Settings. On the next dialog box, check Enable SSL Proxying, and Add *.* as in the following image:","<img src=\"/hc/article_attachments/115009780406/Charles3.png\" alt=\"Charles3.png\" width=\"725\" height=\"458\">","6. We will now configure your mobile device to use your PC as the network proxy.&#xA0;","<strong>For Android:</strong>","\n<li>Two-finger swipe from the top of the device (if using the default UI)</li>\n<li>Choose the gear icon from the top of the screen (to go to Settings)</li>\n<li>Select Wi-Fi</li>\n<li>Select the same Wifi network that you are using on your PC using a long press which will provide the additional option to Modify Network</li>\n<li>Check Show Advanced Options which will allow you to set a Manual Proxy</li>\n<li>For Proxy hostname, use the IP address of your PC. You can easily obtain this value&#xA0;from within Charles by selecting Local IP Address from the Help menu</li>\n<li>For Proxy port, use the Charles default of 8888</li>\n<li>Select Save</li>\n<li>Stop and Restart Wi-Fi on the device by selecting the On/Off slider (or restart the device)</li>\n<li>You will likely receive a pop up in Charles asking to to Allow or Deny the device requests</li>\n<li>On the device, browse to chls.pro/ssl to download and install the Charles certificate. Name the certificate to your choosing.</li>\n<li>On the PC/Mac, ensure that Recording is enabled.</li>\n<li>On the device, launch your game.</li>\n<li>You should now start to see the events being recorded (see note on Android Nougat below). You should see requests being sent to one or more of the following URLs. Expand them to see the actual events.</li>\n","https://config.uca.cloud.unity3d.com","https://api.uca.cloud.unity3d.com (generally the one you want to monitor)","https://cdp.cloud.unity3d.com","If you are running Android Nougat 7, you will need to perform the additional steps:","\n<li>In your Unity project, add the following to the <code>application</code> element in your android manifest:</li>\n","<code>android:networkSecurityConfig=&quot;@xml/network_security_config&quot;</code>","\n<li>Create a&#xA0;<code>network_security_config.xml</code>&#xA0;file in the following folder:</li>\n","<code>Assets/Plugins/Android/res/xml</code>","\n<li>Contents of network_security_config.xml:</li>\n","<code>&lt;network-security-config&gt;\n&#xA0;&#xA0;&#xA0;&#xA0;&lt;base-config&gt;\n&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;trust-anchors&gt;\n&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;certificates src=&quot;user&quot; /&gt;\n&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;certificates src=&quot;system&quot; /&gt;\n&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&lt;/trust-anchors&gt;\n&#xA0;&#xA0;&#xA0;&#xA0;&lt;/base-config&gt;\n&lt;/network-security-config&gt;</code>","\n<li>Build and deploy the app using Android Studio</li>\n","<strong>For IOS:</strong>","The steps are similar as above.","\n<li class=\"wysiwyg-indent1\">Go to Settings/Wi-Fi</li>\n<li class=\"wysiwyg-indent1\">Next to the Wifi network name, click the &quot;i&quot; (information) icon</li>\n<li class=\"wysiwyg-indent1\">Scroll down to the HTTP PROXY section</li>\n<li class=\"wysiwyg-indent1\">Set the Server and Port as above (do not check Authentication)</li>\n<li class=\"wysiwyg-indent1\">Stop and then start Wifi</li>\n<li class=\"wysiwyg-indent1\">Download and install the Charles certificate as above by browsing to chls.pro/ssl on the device</li>\n<li class=\"wysiwyg-indent1\">Trust the certificate by going to Settings/General/About/Certificate Trust Settings, and select Enable Full Trust for Root Certificates for the Charles Proxy certificate.</li>\n<li class=\"wysiwyg-indent1\">Launch your Analytics-enabled Unity application. You should begin to see the events listed in Charles.</li>\n","&#xA0;<strong>For PC - Windows 10:</strong>","\n<li class=\"wysiwyg-indent1\">In Charles, from the SSL Proxying menu, choose Install Charles Root Certificate</li>\n<li class=\"wysiwyg-indent1\">In the subsequent dialog, choose Install Certificate. Choose Current User, and choose Automatically select the certificate store, then Finish.</li>\n<li class=\"wysiwyg-indent1\">We will now run the Windows Certificate Manager from the Windows Start Menu, All Apps, Windows System, and Run. In the Run dialog, enter certmgr.msc and click OK.</li>\n<li class=\"wysiwyg-indent1\">By clicking and dragging, move the Charles Proxy CA certificate from the Personal/Certificates store to the Trusted Root Certification Authorities/Certificates store as shown below. Charles should now capture and display network traffic on your PC</li>\n","<img src=\"/hc/article_attachments/115010267643/Charles4.png\" alt=\"Charles4.png\" width=\"727\" height=\"493\">","&#xA0;","<code>\n</code><code></code>"]}]}]