
        <p><strong>Symptoms</strong> </p>
<ul>
<li>I would like to change the  <strong>&#x201C;server:port&#x201D;</strong>  info in my project to connect to another Cache Server without loading the Editor UI because of my automation system. </li>
<li>I would like to connect to different Cache Servers depending on my particular build needs from the command line.</li>
</ul>
<p><strong>Cause</strong> </p>
<p>Unity uses the settings introduced by the Editor (UI) following this path:  <strong>&#x201C;Preferences &gt; Cache Server &gt; IP Address.&#x201D;</strong>  &#xA0;So what happens if you use an automation build system, and the system needs to connect to different Cache Servers according to some conditions?</p>
<p>For example, the iOS-Debug version uses the Cache Server 1 &lt;127.0.0.1:3030&gt;, and the iOS-Production version uses the Cache Server 2 &lt;127.0.0.1:3031&gt;.</p>
<p>We cannot change this info in the Editor (UI) because our automation system does not load the Editor (UI). Instead, it runs Unity from the command line.</p>
<p><strong>Resolution</strong> </p>
<p>This setting is an EditorPrefs, so we can change its value by using the EditorPrefs class (check the documentation link below). &#xA0;We have to use an Editor Script and call a function (static function) by command line, which changes the Cache Server info and then runs the build.</p>
<p>An option for the command should support the IP and the PORT as arguments, having something like:</p>
<p><strong><em>OSX Terminal:</em> </strong> </p>
<p>/Applications/Unity/Unity.app/Contents/MacOS/Unity -batchmode -executeMethod Builder.iOSDebug -ip=&lt;IP&gt; -port=&lt;PORT&gt; -logFile</p>
<p><strong><em>Windows CMD:</em> </strong> </p>
<p>Path/To/Unity.exe -batchmode -executeMethod Builder.iOSDebug -ip=&lt;IP&gt; -port=&lt;PORT&gt; -logFile</p>
<p>Something important here is the missing &#x201C;-quit&#x201D; argument. On OSX this argument will break the functionality of EditorPrefs, because of this, we have to use EditorApplication.Exit(0) in our script, as a workaround.</p>
<p>Now, we can follow these steps to solve this issue:</p>
<ul>
<li>Create a new script called &#x201C;Builder.cs&#x201D; inside of a folder called Editor (might be Assets/Editor/Builder.cs, but this location is not mandatory).</li>
<li>In our Builder.cs script we will add a function to read the command and its arguments.</li>
<li>If the argument list includes an option like &#x201C;-ip=&#x201D; and &#x201C;-post=&#x201D;, the script will get their values and will change the Cache Server settings.</li>
<li>Finally, the script will dispatch our build process (You could also use this step to run other processes, for example updating your server cache, reimporting assets, etc).</li>
</ul>
<p>Builder.cs:</p>
<p>using UnityEngine;<br>using UnityEditor;<br>using System;<br><br>class Builder<br>{ &#xA0;&#xA0;<br> &#xA0;&#xA0;&#xA0;// This method will get any param from the arguments and its value.<br> &#xA0;&#xA0;&#xA0;static string GetParam ( string[] args, string param, string defaultValue )<br> &#xA0;&#xA0;&#xA0;{<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;string tmpValue = defaultValue;<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;for (int i = 0; i &lt; args.Length; i++) <br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;if (args [i].IndexOf (param) != -1) <br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;tmpValue = args [i].Split (&apos;=&apos;) [1].Trim ();<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}<br><br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;return String.IsNullOrEmpty ( tmpValue ) ? defaultValue : tmpValue;<br> &#xA0;&#xA0;&#xA0;}<br><br> &#xA0;&#xA0;&#xA0;static void iOSDebug ()<br> &#xA0;&#xA0;&#xA0;{<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Get the IP from the command line argument list, if it doesn&apos;t have any IP argument, uses localhost by default.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;string tmpIP = GetParam (Environment.GetCommandLineArgs (), &quot;ip=&quot;, &quot;127.0.0.1&quot; );<br><br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Get the PORT from the command line argument list, if it doesn&apos;t have any PORT argument, uses 0 by default.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;string tmpPort = GetParam (Environment.GetCommandLineArgs (), &quot;port=&quot;, &quot;0&quot; ); <br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Show the Cache Server current settings.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (&quot;Show the Cache Server current settings ...&quot;);<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (EditorPrefs.GetBool (&quot;CacheServerEnabled&quot;));<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (EditorPrefs.GetString (&quot;CacheServerIPAddress&quot;, &quot;Unknown&quot;));<br><br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Set the new settings.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (&quot;Changing the Cache Server settings ...&quot;);<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;EditorPrefs.SetBool (&quot;CacheServerEnabled&quot;, true);<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;EditorPrefs.SetString (&quot;CacheServerIPAddress&quot;, tmpIP + &quot;:&quot; + tmpPort );<br><br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// Show the new values.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (&quot;Done: &quot;);<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (EditorPrefs.GetBool (&quot;CacheServerEnabled&quot;));<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;Debug.Log (EditorPrefs.GetString (&quot;CacheServerIPAddress&quot;, &quot;Unknown&quot;));<br><br><br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// To use this method from command line use</p>
<p> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// $ /Applications/Unity/Unity.app/Contents/MacOS/Unity -batchmode -executeMethod Builder.iOSDebug -logFile<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// $ /Applications/Unity/Unity.app/Contents/MacOS/Unity -batchmode -executeMethod Builder.iOSDebug -ip=&lt;IP&gt; -port=&lt;PORT&gt; -logFile<br><br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// As you can see, the command doesn&apos;t have the argument &quot;-quit&quot;, that is because this parameter will fail the EditorPrefs functionality on OSX. <br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// To workaround that issue we need to skip it and use EditorApplication.Exit(0) instead.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// It will work with &quot;-quit&quot; option on Windows anyway.<br> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;EditorApplication.Exit(0);<br> &#xA0;&#xA0;&#xA0;}<br>}</p>
<p><strong>More Information</strong> </p>
<ul>
<li><a href="https://docs.unity3d.com/ScriptReference/EditorPrefs.html">https://docs.unity3d.com/ScriptReference/EditorPrefs.html</a></li>
<li><a href="https://docs.unity3d.com/ScriptReference/EditorApplication.Exit.html">https://docs.unity3d.com/ScriptReference/EditorApplication.Exit.html</a></li>
<li><a href="https://docs.unity3d.com/Manual/CommandLineArguments.html">https://docs.unity3d.com/Manual/CommandLineArguments.html</a></li>
<li><a href="https://docs.unity3d.com/Manual/CacheServer.html">https://docs.unity3d.com/Manual/CacheServer.html</a></li>
<li><a href="https://support.unity3d.com/hc/en-us/articles/115000368846-How-do-I-support-different-configurations-to-build-specific-players-by-command-line-or-auto-build-system-">https://support.unity3d.com/hc/en-us/articles/115000368846-How-do-I-support-different-configurations-to-build-specific-players-by-command-line-or-auto-build-system-</a></li>
</ul>
      