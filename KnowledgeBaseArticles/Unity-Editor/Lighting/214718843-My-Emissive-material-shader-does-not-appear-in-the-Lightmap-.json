[{"title":"My Emissive material/shader does not appear in the Lightmap.","authorName":"Juan Diego Uran.","createdDate":"2016-09-29T14:18:16Z","updatedDate":"2017-03-17T02:35:45Z","labels":["Graphics","Shader","Materials","Lightmap","Emissive"],"sections":[{"title":"Symptoms","content":["\n<li><span>My Emissive material/shader does not appear in my Lightmap.</span></li>\n<li><span>My Emissive material/shader sometimes appears and sometimes does not.</span></li>\n"]},{"title":"Cause","content":["<span>Unity needs the flag </span><strong>Emission GI</strong><span> set to </span><strong>Baked</strong><span> always, to include the Emissive materials into lightmaps, and a custom shader may not have this flag.</span>"]},{"title":"Resolution","content":["<span>To get the Emissive material into the lightmap, please follow these steps:</span>","\n<li><span>Make sure lightmap UVs are included in the mesh. </span><span>Use the option </span><strong>&#x201C;Mode &gt; Import Settings &gt; Generate Lightmap UV&#x201D;</strong><span> in the mesh importer to create the second UV channel utilized by the Lightmapping.</span></li>\n<li><span>Checking the option </span><strong>Important GI</strong><span> from the </span><strong>&#x201C;Lighting Window &gt; Object &gt; Important GI&#x201D;</strong><span>. Sometimes Enlighten will cull small objects away because they are small relative to the indirect resolution. To avoid this behavior use this option on each object that you want to include into the lightmap (even Emissive Objects).</span></li>\n<li><span>Set the </span><strong>&#x201C;Emission &gt; Global Illumination&#x201D; </strong><span>to</span><strong> Baked</strong>.<span> It makes the Emissive light from this material to be baked into the static lightmaps for the scene. You can find this option seeing the material into the Inspector panel.</span></li>\n","<span>If you custom shaders, you cannot make the third point from the shader code and you cannot get Emissive light into the Lightmaps because of that.&#xA0; In this case, we have to use a script to solves this problem:</span>","<em><span>using</span></em><em><span> UnityEngine;</span></em>","<em><span>using</span></em><em><span> UnityEditor;</span></em>","<em><span>public</span></em> <em><span>class</span></em><em><span> LightMapMenu : </span></em><em><span>MonoBehaviour</span></em>","<em><span>{</span></em>","<em><span> &#xA0;&#xA0;&#xA0;</span></em><em><span>// The menu item.</span></em>","<em><span> &#xA0;&#xA0;&#xA0;[</span></em><em><span>MenuItem</span></em><em><span> (</span></em><em><span>&quot;MyCustomBake/Bake&quot;</span></em><em><span>)]</span></em>","<em><span> &#xA0;&#xA0;&#xA0;</span></em><em><span>static</span></em> <em><span>void</span></em><em><span> Bake () </span></em>","<em><span> &#xA0;&#xA0;&#xA0;{</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>// Find all objects with the tag &lt;Emissive_to_baked&gt;</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;// We have to set the tag &#x201C;Emissive_to_baked&#x201D; on each GO to be baked.</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>GameObject</span></em><em><span>[] _emissiveObjs = </span></em><em><span>GameObject</span></em><em><span>.FindGameObjectsWithTag(</span></em><em><span>&quot;Emissive_to_baked&quot;</span></em><em><span>);</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>// Then, by each object, set the globalIllumiationFlags to BakedEmissive.</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>foreach</span></em><em><span> (</span></em><em><span>GameObject</span></em><em><span> tmpObj </span></em><em><span>in</span></em><em><span> _emissiveObjs) </span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;{</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>Material</span></em><em><span> tmpMaterial = tmpObj.GetComponent&lt;</span></em><em><span>Renderer</span></em><em><span>&gt; ().sharedMaterial;</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;tmpMaterial.globalIlluminationFlags = MaterialGlobalIlluminationFlags.BakedEmissive;</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;}</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>// Bake the lightmap.</span></em>","<em><span> &#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;&#xA0;</span></em><em><span>Lightmapping</span></em><em><span>.Bake ();</span></em>","<em><span> &#xA0;&#xA0;&#xA0;}</span></em>","<em><span>}</span></em>","<span>This script will set the </span><strong>Global Illumination</strong><span> option to </span><strong>Baked</strong><span> in each object tagged as </span><strong>Emissive_to_Lightmap</strong><span>. It will then execute the Bake function to create the Lightmap. &#xA0;Now, everything should work as expected and the Emissive Light should appear in the Lightmap even with custom shaders.</span>"]},{"title":"More Information","content":["<span>For scripting:</span>","\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Lightmapping.Bake.html\"><span>https://docs.unity3d.com/ScriptReference/Lightmapping.Bake.html</span></a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/Material-globalIlluminationFlags.html\"><span>https://docs.unity3d.com/ScriptReference/Material-globalIlluminationFlags.html</span></a></li>\n<li><a href=\"https://docs.unity3d.com/ScriptReference/MaterialGlobalIlluminationFlags.html\"><span>https://docs.unity3d.com/ScriptReference/MaterialGlobalIlluminationFlags.html</span></a></li>\n","<span>For Tags System:</span>","\n<li><a href=\"https://docs.unity3d.com/Manual/Tags.html\"><span>https://docs.unity3d.com/Manual/Tags.html</span></a></li>\n","<span>For Emissive Standard Shader Settings:</span>","\n<li><a href=\"https://docs.unity3d.com/Manual/StandardShaderMaterialParameterEmission.html\"><span>https://docs.unity3d.com/Manual/StandardShaderMaterialParameterEmission.html</span></a></li>\n","<span>For Generate Lightmap UV:</span>","\n<li><a href=\"https://docs.unity3d.com/Manual/FBXImporter-Model.html\"><span>https://docs.unity3d.com/Manual/FBXImporter-Model.html</span></a></li>\n","<span>For Important GI:</span>","\n<li><a href=\"https://docs.unity3d.com/Manual/GlobalIllumination.html\"><span>https://docs.unity3d.com/Manual/GlobalIllumination.html</span></a></li>\n","<span>For Lighting and rendering (Search by &#x201C;Emissive Materials&#x201D;):</span>","\n<li><a href=\"https://unity3d.com/learn/tutorials/topics/graphics/unity-5-lighting-and-rendering\"><span>https://unity3d.com/learn/tutorials/topics/graphics/unity-5-lighting-and-rendering</span></a></li>\n"]}]}]